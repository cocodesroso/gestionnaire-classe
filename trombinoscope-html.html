<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trombinoscope - Gestionnaire</title>
    
    <!-- CSS -->
    <link rel="stylesheet" href="css/main-css.css">
    <link rel="stylesheet" href="css/header-css.css">
    <link rel="stylesheet" href="css/trombinoscope-css.css">
    
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- Le header sera charg√© dynamiquement par header-js.js -->

    <!-- Contenu principal -->
    <main class="main-content">
        <div class="trombinoscope-container">
            <!-- En-t√™te avec retour -->
            <div class="trombinoscope-header">
                <div class="header-left-group">
                    <button class="btn-back" id="backBtn" onclick="window.location.href='classes-html.html'">
                        ‚Üê Classes
                    </button>
                    <h1 class="trombinoscope-title" id="classTitle">Classe...</h1>
                </div>
                
                <div class="sort-buttons">
                    <span class="sort-label">Trier :</span>
                    <button class="btn-sort" id="sortLastNameBtn" data-order="none">
                        Nom <span class="sort-icon">‚áÖ</span>
                    </button>
                    <button class="btn-sort" id="sortFirstNameBtn" data-order="none">
                        Pr√©nom <span class="sort-icon">‚áÖ</span>
                    </button>
                </div>
                
                <div class="filter-buttons">
                    <span class="filter-label">Afficher :</span>
                    <label class="radio-filter">
                        <input type="radio" name="groupFilter" value="all" checked>
                        <span>Classe</span>
                    </label>
                    <label class="radio-filter">
                        <input type="radio" name="groupFilter" value="ap1">
                        <span>AP1</span>
                    </label>
                    <label class="radio-filter">
                        <input type="radio" name="groupFilter" value="ap2">
                        <span>AP2</span>
                    </label>
                    <button class="btn-toggle-photos" id="togglePhotosBtn" title="Masquer/Afficher les photos">
                        üëÅÔ∏è
                    </button>
                </div>
                
                <div class="header-actions-group">
                    <button class="btn-add-student" id="addStudentBtn">+ Nouvel √©l√®ve</button>
                    <button class="btn-import-csv" id="importCsvBtn">üì• Importer CSV</button>
                    <input type="file" id="csvFileInput" accept=".csv" style="display: none;">
                </div>
            </div>

            <!-- Grille des √©l√®ves -->
            <div class="students-grid" id="studentsGrid">
                <!-- Les √©l√®ves seront charg√©s dynamiquement -->
            </div>

            <!-- Message si aucun √©l√®ve -->
            <div class="no-students hidden" id="noStudents">
                <div class="no-students-icon">üë•</div>
                <h3>Aucun √©l√®ve pour le moment</h3>
                <p>Commencez par ajouter votre premier √©l√®ve</p>
            </div>
        </div>
    </main>

    <!-- Modal Ajouter/Modifier un √©l√®ve -->
    <div class="modal hidden" id="studentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Nouvel √©l√®ve</h3>
                <span class="close-modal" id="closeModal">&times;</span>
            </div>
            
            <div class="modal-body">
                <div class="form-group">
                    <label for="studentFirstName">Pr√©nom *</label>
                    <input type="text" id="studentFirstName" placeholder="Ex: Jean" maxlength="100">
                </div>
                
                <div class="form-group">
                    <label for="studentLastName">Nom *</label>
                    <input type="text" id="studentLastName" placeholder="Ex: DUPONT" maxlength="100">
                </div>
                
                <div class="form-group">
                    <label for="studentBirthdate">Date de naissance (optionnel)</label>
                    <input type="date" id="studentBirthdate">
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn-cancel" id="cancelBtn">Annuler</button>
                <button class="btn-save" id="saveStudentBtn">Enregistrer</button>
            </div>
        </div>
    </div>

    <!-- Modal Confirmation Suppression -->
    <div class="modal hidden" id="deleteModal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h3>Confirmer la suppression</h3>
                <span class="close-modal" id="closeDeleteModal">&times;</span>
            </div>
            
            <div class="modal-body">
                <p>√ätes-vous s√ªr de vouloir supprimer cet √©l√®ve ?</p>
                <p class="warning-text">‚ö†Ô∏è Cette action est irr√©versible</p>
            </div>
            
            <div class="modal-footer">
                <button class="btn-cancel" id="cancelDeleteBtn">Annuler</button>
                <button class="btn-delete" id="confirmDeleteBtn">Supprimer</button>
            </div>
        </div>
    </div>

    <!-- Modal R√©sultat Import CSV -->
    <div class="modal hidden" id="importResultModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üì• R√©sultat de l'import</h3>
                <span class="close-modal" id="closeImportResultModal">&times;</span>
            </div>
            
            <div class="modal-body">
                <div id="importResultContent"></div>
            </div>
            
            <div class="modal-footer">
                <button class="btn-save" id="closeImportBtn">OK</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/config-js.js"></script>
    <script src="js/header-js.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <script src="js/trombinoscope-js.js"></script>
    <script>
        // V√©rifier l'authentification au chargement
        async function checkAuth() {
            const { data: { session } } = await supabase.auth.getSession();
            
            if (!session) {
                // Pas de session, rediriger vers login
                window.location.href = 'login-html.html';
                return;
            }

            console.log('‚úì Utilisateur authentifi√©:', session.user.email);
        }

        // V√©rifier l'authentification au chargement
        checkAuth();
    </script>
</body>
</html>